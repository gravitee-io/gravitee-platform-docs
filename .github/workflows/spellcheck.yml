name: Spellcheck Documentation

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  spellcheck:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Codespell
        run: pip install codespell

      - name: Load spellcheck patterns
        run: |
          SPELLCHECK_PATTERN=""
          while IFS= read -r line || [ -n "$line" ]; do
            SPELLCHECK_PATTERN+="$line|"
          done < .github/spellcheck-pattern.txt
          SPELLCHECK_PATTERN="${SPELLCHECK_PATTERN%|}"  # Remove trailing "|"
          printf "Using spellcheck pattern: %s\n" "$SPELLCHECK_PATTERN"
          echo "SPELLCHECK_PATTERN=$SPELLCHECK_PATTERN" >> $GITHUB_ENV

      - name: Run Spellcheck
        run: |
          mkdir -p spellcheck-reports
          codespell --ignore-words=.github/spellcheck_ignore.txt \
                    --skip="*.json,*.xml,*.html,*.css,*.yml,*.yaml,*.csv,*.ts,*.js,*.py" \
                    --regex "$SPELLCHECK_PATTERN" \
                    --quiet-level=2 \
                    --write-changes \
                    --check-filenames \
                    --check-hidden \
                    > spellcheck-reports/spellcheck-results.txt || true

      - name: Upload Spellcheck Report
        uses: actions/upload-artifact@v4
        with:
          name: spellcheck-results
          path: spellcheck-reports/spellcheck-results.txt
